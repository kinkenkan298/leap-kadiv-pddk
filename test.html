<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rekap Rapor Siswa</title>

    <!-- Bootstrap 4.6 CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    />
    <!-- FontAwesome 5 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f8f9fa;
        font-family: "Inter", sans-serif;
        color: #343a40;
        padding-bottom: 3rem;
      }

      /* --- Custom UI Styling --- */
      .card-custom {
        border: 1px solid #e2e8f0;
        border-radius: 0.75rem;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        background-color: white;
        margin-bottom: 1.5rem;
        transition: all 0.2s;
      }

      .card-header-custom {
        background-color: white;
        border-bottom: 1px solid #f1f5f9;
        padding: 1.25rem 1.5rem;
        border-top-left-radius: 0.75rem !important;
        border-top-right-radius: 0.75rem !important;
      }

      /* Soft Badges */
      .badge-soft-success {
        background-color: #dcfce7;
        color: #166534;
      }
      .badge-soft-danger {
        background-color: #fee2e2;
        color: #991b1b;
      }
      .badge-soft-primary {
        background-color: #dbeafe;
        color: #1e40af;
      }
      .badge-soft-warning {
        background-color: #fef9c3;
        color: #854d0e;
      }
      .badge-soft-orange {
        background-color: #ffedd5;
        color: #9a3412;
      }

      .badge-pill-custom {
        padding: 0.4em 0.8em;
        font-weight: 600;
        font-size: 0.75rem;
        border-radius: 9999px;
      }

      /* Stats Icons */
      .icon-circle {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
      }

      /* Table Styling */
      .table th {
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #64748b;
        border-top: none;
        border-bottom: 1px solid #e2e8f0;
        background-color: #f8fafc;
      }
      .table td {
        vertical-align: middle;
        font-size: 0.875rem;
        border-top: 1px solid #f1f5f9;
      }
      .table-hover tbody tr:hover {
        background-color: #f1f5f9;
      }

      /* Modal Styling */
      .modal-content {
        border-radius: 0.75rem;
        border: none;
      }
      .detail-section-title {
        font-size: 0.9rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 1rem;
        border-bottom: 2px solid #f1f5f9;
        padding-bottom: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid py-4" style="max-width: 1200px">
      <!-- Title Section -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="h3 font-weight-bold text-dark mb-1">Rekap Rapor Siswa</h2>
          <p class="text-muted small mb-0">
            Tahun Ajaran 2023/2024 - Semester Genap
          </p>
        </div>
        <button
          class="btn btn-outline-primary btn-sm font-weight-bold shadow-sm"
          onclick="alert('Exporting PDF...')"
        >
          <i class="fas fa-file-export mr-2"></i> Export Data
        </button>
      </div>

      <!-- Summary Stats -->
      <div class="row">
        <div class="col-md-3 mb-3">
          <div class="card card-custom h-100 border-left-primary">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <p class="text-muted small font-weight-bold mb-1">
                  Total Siswa
                </p>
                <h3 class="font-weight-bold mb-0" id="statTotal">0</h3>
              </div>
              <div class="icon-circle bg-light text-primary">
                <i class="fas fa-users"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card card-custom h-100">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <p class="text-muted small font-weight-bold mb-1">Lulus</p>
                <h3
                  class="font-weight-bold text-success mb-0"
                  id="statGraduated"
                >
                  0
                </h3>
                <small class="text-muted">Siswa</small>
              </div>
              <div class="icon-circle badge-soft-success">
                <i class="fas fa-graduation-cap"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card card-custom h-100">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <p class="text-muted small font-weight-bold mb-1">
                  Perlu Remedial
                </p>
                <h3 class="font-weight-bold text-danger mb-0" id="statRemedial">
                  0
                </h3>
                <small class="text-muted">Siswa</small>
              </div>
              <div class="icon-circle badge-soft-danger">
                <i class="fas fa-exclamation-circle"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card card-custom h-100">
            <div
              class="card-body d-flex justify-content-between align-items-center"
            >
              <div>
                <p class="text-muted small font-weight-bold mb-1">
                  Rata-rata Nilai
                </p>
                <h3 class="font-weight-bold mb-0" id="statAverage">0</h3>
              </div>
              <div class="icon-circle badge-soft-primary">
                <i class="fas fa-chart-line"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Alert Section (Conditional) -->
      <div id="alertSection" style="display: none" class="mb-3">
        <div
          class="alert badge-soft-orange border border-warning shadow-sm"
          role="alert"
        >
          <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle mr-3 text-warning fa-lg"></i>
            <div>
              <span class="font-weight-bold text-dark"
                >Perhatian Diperlukan:</span
              >
              <span class="text-dark small">
                Terdapat
                <span
                  class="font-weight-bold text-danger"
                  id="alertRemedialCount"
                  >0</span
                >
                siswa remedial dan
                <span class="font-weight-bold text-warning" id="alertRiskCount"
                  >0</span
                >
                siswa berisiko. Mohon segera jadwalkan bimbingan konseling.
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Table Section -->
      <div class="card card-custom">
        <div
          class="card-header-custom d-flex flex-column flex-md-row justify-content-between align-items-md-center sticky-top bg-white"
          style="z-index: 10"
        >
          <div class="mb-3 mb-md-0">
            <h5 class="font-weight-bold mb-1">Daftar Hasil Belajar</h5>
            <p class="text-muted small mb-0">
              Monitoring status kelulusan dan nilai akhir.
            </p>
          </div>
          <div class="form-inline">
            <!-- Search -->
            <div class="input-group input-group-sm mr-2 mb-2 mb-md-0 shadow-sm">
              <div class="input-group-prepend">
                <span class="input-group-text bg-white border-right-0"
                  ><i class="fas fa-search text-muted"></i
                ></span>
              </div>
              <input
                type="text"
                id="searchInput"
                class="form-control border-left-0"
                placeholder="Cari Nama / NISN..."
              />
            </div>
            <!-- Filter -->
            <div class="input-group input-group-sm shadow-sm">
              <div class="input-group-prepend">
                <span class="input-group-text bg-white border-right-0"
                  ><i class="fas fa-filter text-muted"></i
                ></span>
              </div>
              <select
                class="custom-select border-left-0"
                id="statusFilter"
                style="min-width: 140px"
              >
                <option value="all">Semua Status</option>
                <option value="Graduated">Lulus</option>
                <option value="On Track">On Track</option>
                <option value="At Risk">Berisiko</option>
                <option value="Remedial">Remedial</option>
              </select>
            </div>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th class="pl-4">Nama Siswa</th>
                <th>Kelas</th>
                <th>NISN</th>
                <th class="text-center">Rata-rata</th>
                <th class="text-center">Peringkat</th>
                <th class="text-center">Kehadiran</th>
                <th>Status</th>
                <th class="text-right pr-4">Aksi</th>
              </tr>
            </thead>
            <tbody id="studentTableBody">
              <!-- Data will be injected via JS -->
            </tbody>
          </table>
        </div>
        <div class="card-footer bg-white border-top-0 py-3">
          <small class="text-muted" id="showingCount"
            >Menampilkan semua data</small
          >
        </div>
      </div>
    </div>

    <!-- MODAL DETAIL -->
    <div
      class="modal fade"
      id="detailModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div
        class="modal-dialog modal-xl modal-dialog-scrollable"
        role="document"
      >
        <div class="modal-content">
          <div class="modal-header border-bottom-0 pb-0">
            <div>
              <h5 class="modal-title font-weight-bold" id="modalName">
                Nama Siswa
              </h5>
              <p class="mb-0 small text-muted">
                <span id="modalClass">Kelas</span> â€¢ NISN:
                <span id="modalNisn"></span>
              </p>
            </div>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Overview Cards in Modal -->
            <div class="row mb-4 pt-3">
              <div class="col-md-3 col-6 mb-3 mb-md-0">
                <div class="p-3 bg-light rounded border text-center h-100">
                  <small class="text-muted d-block font-weight-bold"
                    >Peringkat Kelas</small
                  >
                  <h4
                    class="font-weight-bold text-primary mb-0 mt-1"
                    id="modalRank"
                  >
                    -
                  </h4>
                </div>
              </div>
              <div class="col-md-3 col-6 mb-3 mb-md-0">
                <div class="p-3 bg-light rounded border text-center h-100">
                  <small class="text-muted d-block font-weight-bold"
                    >Nilai Rata-rata</small
                  >
                  <h4
                    class="font-weight-bold text-dark mb-0 mt-1"
                    id="modalAverage"
                  >
                    -
                  </h4>
                </div>
              </div>
              <div class="col-md-3 col-6">
                <div class="p-3 bg-light rounded border text-center h-100">
                  <small class="text-muted d-block font-weight-bold"
                    >Kehadiran</small
                  >
                  <h4
                    class="font-weight-bold text-success mb-0 mt-1"
                    id="modalAttendance"
                  >
                    -
                  </h4>
                </div>
              </div>
              <div class="col-md-3 col-6">
                <div
                  class="p-3 bg-light rounded border text-center h-100 d-flex flex-column justify-content-center align-items-center"
                >
                  <small class="text-muted d-block font-weight-bold mb-1"
                    >Status Akhir</small
                  >
                  <div id="modalStatusBadge"></div>
                </div>
              </div>
            </div>

            <div class="row">
              <!-- Academic Table -->
              <div class="col-lg-8 mb-4">
                <div class="card card-custom h-100 mb-0">
                  <div class="card-body p-0">
                    <div class="p-3 border-bottom">
                      <h6 class="font-weight-bold mb-0 text-primary">
                        <i class="fas fa-book mr-2"></i>Rincian Nilai Mata
                        Pelajaran
                      </h6>
                    </div>
                    <div class="table-responsive">
                      <table class="table table-sm table-striped mb-0">
                        <thead class="thead-light">
                          <tr>
                            <th class="pl-3 border-top-0">Mata Pelajaran</th>
                            <th class="text-center border-top-0">KKM</th>
                            <th class="text-center border-top-0">Nilai</th>
                            <th class="text-center border-top-0">Predikat</th>
                            <th class="text-center border-top-0">Status</th>
                            <th class="text-center border-top-0">Tren</th>
                          </tr>
                        </thead>
                        <tbody id="modalSubjectsBody"></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Side Info (Extracurricular & Behavior) -->
              <div class="col-lg-4">
                <!-- Extracurricular -->
                <div class="card card-custom mb-3">
                  <div class="card-body">
                    <h6 class="detail-section-title">
                      <i class="fas fa-running mr-2 text-info"></i
                      >Ekstrakurikuler
                    </h6>
                    <ul
                      class="list-group list-group-flush small"
                      id="modalExtracurricular"
                    ></ul>
                  </div>
                </div>

                <!-- Behavior -->
                <div class="card card-custom mb-0">
                  <div class="card-body">
                    <h6 class="detail-section-title">
                      <i class="fas fa-user-check mr-2 text-success"></i>Catatan
                      Wali Kelas
                    </h6>
                    <div class="alert badge-soft-primary border-0 mb-3 small">
                      <i class="fas fa-quote-left mr-2 opacity-50"></i>
                      <span id="modalNotes" class="font-italic"></span>
                    </div>
                    <table class="table table-borderless table-sm small mb-0">
                      <tr>
                        <td class="text-muted pl-0">Kedisiplinan</td>
                        <td
                          class="font-weight-bold text-right pr-0"
                          id="modalDiscipline"
                        >
                          -
                        </td>
                      </tr>
                      <tr>
                        <td class="text-muted pl-0">Kerjasama</td>
                        <td
                          class="font-weight-bold text-right pr-0"
                          id="modalCooperation"
                        >
                          -
                        </td>
                      </tr>
                      <tr>
                        <td class="text-muted pl-0">Tanggung Jawab</td>
                        <td
                          class="font-weight-bold text-right pr-0"
                          id="modalResponsibility"
                        >
                          -
                        </td>
                      </tr>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer bg-light border-top-0">
            <button
              type="button"
              class="btn btn-secondary btn-sm px-4"
              data-dismiss="modal"
            >
              Tutup
            </button>
            <button
              type="button"
              class="btn btn-primary btn-sm px-4"
              onclick="alert('Printing...')"
            >
              <i class="fas fa-print mr-2"></i>Cetak Rapor
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // --- 1. DATA (Tetap sama seperti React state awal) ---
      const STUDENT_REPORTS = [
        {
          id: "1",
          name: "Artika Dewi Kamma Yoni",
          nisn: "0051234567",
          class: "X-A",
          overallAverage: 88.5,
          rank: 3,
          totalStudents: 32,
          status: "On Track",
          attendance: { present: 95, total: 100 },
          subjects: [
            {
              name: "Matematika",
              kkm: 75,
              average: 88.3,
              grade: "A",
              status: "Pass",
              trend: "up",
            },
            {
              name: "Bahasa Indo",
              kkm: 75,
              average: 90.0,
              grade: "A",
              status: "Pass",
              trend: "up",
            },
            {
              name: "Bahasa Inggris",
              kkm: 75,
              average: 86.7,
              grade: "A",
              status: "Pass",
              trend: "stable",
            },
            {
              name: "Fisika",
              kkm: 75,
              average: 84.3,
              grade: "B",
              status: "Pass",
              trend: "up",
            },
          ],
          extracurricular: [
            { name: "Pramuka", score: "A", description: "Aktif" },
            { name: "Basket", score: "B", description: "Pemain tim" },
          ],
          behavior: {
            discipline: "Sangat Baik",
            cooperation: "Baik",
            responsibility: "Sangat Baik",
            notes: "Siswa aktif dan berprestasi.",
          },
        },
        {
          id: "2",
          name: "Dimas Anggara Putra",
          nisn: "0051234568",
          class: "XI-C",
          overallAverage: 92.3,
          rank: 1,
          totalStudents: 30,
          status: "Graduated",
          attendance: { present: 98, total: 100 },
          subjects: [
            {
              name: "Matematika",
              kkm: 75,
              average: 94.0,
              grade: "A",
              status: "Pass",
              trend: "up",
            },
            {
              name: "Fisika",
              kkm: 75,
              average: 91.7,
              grade: "A",
              status: "Pass",
              trend: "up",
            },
            {
              name: "Kimia",
              kkm: 75,
              average: 91.0,
              grade: "A",
              status: "Pass",
              trend: "stable",
            },
          ],
          extracurricular: [
            { name: "Olimpiade Math", score: "A", description: "Ketua tim" },
          ],
          behavior: {
            discipline: "Sangat Baik",
            cooperation: "Sangat Baik",
            responsibility: "Sangat Baik",
            notes: "Siswa teladan.",
          },
        },
        {
          id: "3",
          name: "Rudi Hartono",
          nisn: "0051234569",
          class: "X-B",
          overallAverage: 68.2,
          rank: 28,
          totalStudents: 30,
          status: "Remedial",
          attendance: { present: 85, total: 100 },
          subjects: [
            {
              name: "Matematika",
              kkm: 75,
              average: 67.7,
              grade: "D",
              status: "Remedial",
              trend: "up",
            },
            {
              name: "Fisika",
              kkm: 75,
              average: 70.0,
              grade: "C",
              status: "Remedial",
              trend: "down",
            },
            {
              name: "Kimia",
              kkm: 75,
              average: 65.0,
              grade: "D",
              status: "Remedial",
              trend: "up",
            },
          ],
          extracurricular: [],
          behavior: {
            discipline: "Cukup",
            cooperation: "Cukup",
            responsibility: "Perlu Perbaikan",
            notes: "Perlu peningkatan kedisiplinan dan belajar lebih giat.",
          },
        },
        {
          id: "4",
          name: "Siti Nurhaliza",
          nisn: "0051234570",
          class: "XII-A",
          overallAverage: 85.8,
          rank: 5,
          totalStudents: 32,
          status: "Graduated",
          attendance: { present: 96, total: 100 },
          subjects: [
            {
              name: "B. Indo",
              kkm: 75,
              average: 89,
              grade: "A",
              status: "Pass",
              trend: "stable",
            },
            {
              name: "Sejarah",
              kkm: 75,
              average: 86.0,
              grade: "A",
              status: "Pass",
              trend: "up",
            },
          ],
          extracurricular: [
            { name: "Debat", score: "A", description: "Kapten" },
            { name: "OSIS", score: "A", description: "Wakil Ketua" },
          ],
          behavior: {
            discipline: "Sangat Baik",
            cooperation: "Sangat Baik",
            responsibility: "Sangat Baik",
            notes: "Kepemimpinan baik.",
          },
        },
        {
          id: "5",
          name: "Ferry Irawan",
          nisn: "0051234571",
          class: "XI-A",
          overallAverage: 71.5,
          rank: 22,
          totalStudents: 30,
          status: "At Risk",
          attendance: { present: 88, total: 100 },
          subjects: [
            {
              name: "Matematika",
              kkm: 75,
              average: 72,
              grade: "C",
              status: "Remedial",
              trend: "down",
            },
            {
              name: "Fisika",
              kkm: 75,
              average: 70.0,
              grade: "C",
              status: "Remedial",
              trend: "up",
            },
          ],
          extracurricular: [
            { name: "Futsal", score: "B", description: "Anggota" },
          ],
          behavior: {
            discipline: "Cukup",
            cooperation: "Baik",
            responsibility: "Cukup",
            notes: "Perlu bimbingan khusus.",
          },
        },
      ];

      // --- 2. FUNGSI LOGIKA ---

      // Menghitung Statistik Dashboard
      function updateStats() {
        const total = STUDENT_REPORTS.length;
        const grad = STUDENT_REPORTS.filter(
          (s) => s.status === "Graduated",
        ).length;
        const rem = STUDENT_REPORTS.filter(
          (s) => s.status === "Remedial",
        ).length;
        const avg = (
          STUDENT_REPORTS.reduce((sum, s) => sum + s.overallAverage, 0) / total
        ).toFixed(2);
        const atRisk = STUDENT_REPORTS.filter(
          (s) => s.status === "At Risk",
        ).length;

        document.getElementById("statTotal").innerText = total;
        document.getElementById("statGraduated").innerText = grad;
        document.getElementById("statRemedial").innerText = rem;
        document.getElementById("statAverage").innerText = avg;

        // Tampilkan Alert jika ada siswa bermasalah
        const alertSection = document.getElementById("alertSection");
        if (rem > 0 || atRisk > 0) {
          alertSection.style.display = "block";
          document.getElementById("alertRemedialCount").innerText =
            `${rem} siswa`;
          document.getElementById("alertRiskCount").innerText =
            `${atRisk} siswa`;
        } else {
          alertSection.style.display = "none";
        }
      }

      // Helper untuk membuat Badge HTML
      function getStatusBadge(status) {
        switch (status) {
          case "Graduated":
            return `<span class="badge badge-soft-success badge-pill-custom"><i class="fas fa-check-circle mr-1"></i>Lulus</span>`;
          case "Remedial":
            return `<span class="badge badge-soft-danger badge-pill-custom"><i class="fas fa-exclamation-circle mr-1"></i>Remedial</span>`;
          case "On Track":
            return `<span class="badge badge-soft-primary badge-pill-custom"><i class="fas fa-chart-line mr-1"></i>On Track</span>`;
          case "At Risk":
            return `<span class="badge badge-soft-orange badge-pill-custom"><i class="fas fa-exclamation-triangle mr-1"></i>Berisiko</span>`;
          default:
            return `<span class="badge badge-light border badge-pill-custom">${status}</span>`;
        }
      }

      // Render Tabel Utama
      function renderTable() {
        const searchQuery = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const statusFilter = document.getElementById("statusFilter").value;
        const tbody = document.getElementById("studentTableBody");
        tbody.innerHTML = "";

        const filtered = STUDENT_REPORTS.filter((s) => {
          const matchSearch =
            s.name.toLowerCase().includes(searchQuery) ||
            s.nisn.includes(searchQuery) ||
            s.class.toLowerCase().includes(searchQuery);
          const matchStatus =
            statusFilter === "all" || s.status === statusFilter;
          return matchSearch && matchStatus;
        });

        document.getElementById("showingCount").innerText =
          `Menampilkan ${filtered.length} dari ${STUDENT_REPORTS.length} siswa`;

        if (filtered.length === 0) {
          tbody.innerHTML = `<tr><td colspan="8" class="text-center py-5 text-muted"><i class="fas fa-inbox fa-2x mb-3 text-light-gray"></i><p>Tidak ada data siswa yang ditemukan.</p></td></tr>`;
          return;
        }

        filtered.forEach((s) => {
          const attPct = Math.round(
            (s.attendance.present / s.attendance.total) * 100,
          );
          // Warna text kehadiran
          let attColor = "text-success";
          if (attPct < 90) attColor = "text-warning";
          if (attPct < 75) attColor = "text-danger";

          const row = `
                <tr>
                    <td class="pl-4">
                        <div class="font-weight-bold text-dark">${s.name}</div>
                    </td>
                    <td><span class="badge badge-light border">${s.class}</span></td>
                    <td class="text-secondary small">${s.nisn}</td>
                    <td class="text-center font-weight-bold text-dark">${s.overallAverage.toFixed(2)}</td>
                    <td class="text-center text-secondary">${s.rank} / ${s.totalStudents}</td>
                    <td class="text-center ${attColor} font-weight-bold">${attPct}%</td>
                    <td>${getStatusBadge(s.status)}</td>
                    <td class="text-right pr-4">
                        <button class="btn btn-sm btn-outline-primary shadow-sm" onclick="openDetailModal('${s.id}')" title="Lihat Detail">
                            <i class="fas fa-eye"></i> Detail
                        </button>
                    </td>
                </tr>
            `;
          tbody.insertAdjacentHTML("beforeend", row);
        });
      }

      // Logika Modal Detail Siswa
      window.openDetailModal = function (id) {
        const student = STUDENT_REPORTS.find((s) => s.id === id);
        if (!student) return;

        // Isi Header
        $("#modalName").text(student.name);
        $("#modalClass").text(student.class);
        $("#modalNisn").text(student.nisn);

        // Isi Stats Card di Modal
        $("#modalRank").text(`${student.rank} / ${student.totalStudents}`);
        $("#modalAverage").text(student.overallAverage.toFixed(1));
        const attPct = Math.round(
          (student.attendance.present / student.attendance.total) * 100,
        );
        $("#modalAttendance").text(`${attPct}%`);
        if (attPct < 90)
          $("#modalAttendance")
            .removeClass("text-success")
            .addClass("text-warning");
        $("#modalStatusBadge").html(getStatusBadge(student.status));

        // Isi Tabel Mata Pelajaran
        const subjBody = document.getElementById("modalSubjectsBody");
        subjBody.innerHTML = "";
        student.subjects.forEach((sub) => {
          const trendIcon =
            sub.trend === "up"
              ? '<i class="fas fa-arrow-up text-success"></i>'
              : sub.trend === "down"
                ? '<i class="fas fa-arrow-down text-danger"></i>'
                : '<i class="fas fa-minus text-muted"></i>';
          const statusBadge =
            sub.status === "Pass"
              ? '<span class="badge badge-soft-success">Lulus</span>'
              : '<span class="badge badge-soft-danger">Remedial</span>';

          const row = `
                <tr>
                    <td class="pl-3 font-weight-bold text-dark">${sub.name}</td>
                    <td class="text-center text-muted">${sub.kkm}</td>
                    <td class="text-center font-weight-bold">${sub.average}</td>
                    <td class="text-center font-weight-bold">${sub.grade}</td>
                    <td class="text-center">${statusBadge}</td>
                    <td class="text-center small">${trendIcon}</td>
                </tr>
            `;
          subjBody.insertAdjacentHTML("beforeend", row);
        });

        // Isi Ekstrakurikuler
        const extraList = document.getElementById("modalExtracurricular");
        extraList.innerHTML = "";
        if (student.extracurricular.length > 0) {
          student.extracurricular.forEach((ex) => {
            extraList.insertAdjacentHTML(
              "beforeend",
              `
                    <li class="list-group-item px-0 d-flex justify-content-between align-items-center">
                        <div>
                            <span class="font-weight-bold d-block text-dark">${ex.name}</span>
                            <small class="text-muted">${ex.description}</small>
                        </div>
                        <span class="badge badge-info">${ex.score}</span>
                    </li>
                `,
            );
          });
        } else {
          extraList.innerHTML =
            '<li class="text-muted small py-2">Tidak ada data ekstrakurikuler.</li>';
        }

        // Isi Catatan Perilaku
        $("#modalDiscipline").text(student.behavior.discipline);
        $("#modalCooperation").text(student.behavior.cooperation);
        $("#modalResponsibility").text(student.behavior.responsibility);
        $("#modalNotes").text(student.behavior.notes);

        $("#detailModal").modal("show");
      };

      // --- 3. INIT ---
      document.addEventListener("DOMContentLoaded", () => {
        updateStats();
        renderTable();

        // Event Listeners
        document
          .getElementById("searchInput")
          .addEventListener("input", renderTable);
        document
          .getElementById("statusFilter")
          .addEventListener("change", renderTable);
      });
    </script>
  </body>
</html>
